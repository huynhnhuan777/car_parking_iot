<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard · Smart Parking</title>

<style>
:root {
    --bg: #020617;
    --bg-elevated: #020617;
    --accent: #22c55e;
    --accent-soft: rgba(34,197,94,.16);
    --danger: #ef4444;
    --info: #38bdf8;
    --border-subtle: rgba(148,163,184,.36);
    --text-main: #e5e7eb;
    --text-muted: #9ca3af;
    --shadow: 0 24px 70px rgba(15,23,42,.9);
}

* { box-sizing: border-box; }

body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top,#1f2937 0,#020617 55%,#000 100%);
    color: var(--text-main);
    display: flex;
    justify-content: center;
}

.shell {
    width: 100%;
    max-width: 1120px;
    padding: 22px 16px;
}

.layout {
    display: grid;
    grid-template-columns: minmax(0,3fr) minmax(0,2.1fr);
    gap: 18px;
}

/* ===== HEADER ===== */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

h1 { margin: 0; font-size: 22px; text-transform: uppercase; }

.subtitle { font-size: 13px; color: var(--text-muted); }

.admin-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid rgba(248,250,252,.4);
    font-size: 11px;
    text-transform: uppercase;
}

.admin-dot {
    width: 9px;
    height: 9px;
    border-radius: 50%;
    background: #f97316;
    box-shadow: 0 0 0 4px rgba(248,171,84,.35);
}

/* ===== CARD ===== */
.card {
    background: var(--bg-elevated);
    border-radius: 24px;
    padding: 18px;
    border: 1px solid var(--border-subtle);
    box-shadow: var(--shadow);
}

.card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
}

.card-title {
    font-size: 13px;
    text-transform: uppercase;
    color: var(--text-muted);
}

.tag {
    font-size: 11px;
    border: 1px solid rgba(148,163,184,.5);
    padding: 4px 10px;
    border-radius: 999px;
}

.tag-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
}

.ok { background: var(--accent); }
.info { background: var(--info); }

/* ===== METRICS ===== */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(3,1fr);
    gap: 10px;
    margin-bottom: 12px;
}

.metric {
    border: 1px solid rgba(148,163,184,.6);
    border-radius: 16px;
    padding: 10px;
    font-size: 12px;
}

.metric-label {
    text-transform: uppercase;
    font-size: 11px;
    color: var(--text-muted);
}

.metric-value {
    font-size: 16px;
    font-weight: bold;
}

/* ===== TOTAL SLOT BOX ===== */
.total-slot {
    margin-top: 14px;
    padding: 18px;
    border-radius: 18px;
    background: linear-gradient(135deg,#22c55e33,#22c55e11);
    border: 1px solid #22c55e;
    text-align: center;
}

.total-slot-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
}

.total-slot-value {
    font-size: 36px;
    font-weight: 700;
    color: #22c55e;
}

/* ===== LOG TIMELINE ===== */
.log-container {
    max-height: 420px;
    overflow-y: auto;
    padding-right: 6px;
}

.timeline {
    list-style: none;
    padding-left: 0;
    font-size: 13px;
}

.timeline-item {
    position: relative;
    padding-left: 18px;
    margin-bottom: 10px;
}

.timeline-item::before {
    content: "";
    position: absolute;
    left: 6px;
    top: 4px;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: rgba(148,163,184,.8);
}

.timeline-item::after {
    content: "";
    position: absolute;
    left: 9px;
    top: 14px;
    bottom: -6px;
    width: 1px;
    background: rgba(55,65,81,.9);
}

.timeline-item:last-child::after { display: none; }

.timeline-caption {
    font-size: 11px;
    color: var(--text-muted);
}

.logout a {
    display: inline-block;
    margin-top: 12px;
    padding: 8px 16px;
    background: linear-gradient(135deg,#ef4444,#b91c1c);
    border-radius: 999px;
    color: #fff;
    text-decoration: none;
    font-size: 12px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 12px;
    margin-top: 14px;
}

.summary-box {
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(148,163,184,.5);
    text-align: center;
}

.summary-label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
}

.summary-value {
    font-size: 26px;
    font-weight: 700;
}

.in { color: #22c55e; }
.out { color: #ef4444; }

@media (max-width: 900px) {
    .layout { grid-template-columns: 1fr; }
}
</style>
</head>

<body>
<div class="shell">

<header class="header">
    <div>
        <h1>Admin Control Panel</h1>
        <p class="subtitle">
            Xin chào, <strong>{{ admin_name }}</strong> · Điều phối bãi đỗ xe
        </p>
    </div>
    <div class="admin-badge">
        <span class="admin-dot"></span> Admin
    </div>
</header>

<main class="layout">

<!-- ===== LEFT ===== -->
<section class="card">
    <div class="card-header">
        <div class="card-title">Trạng thái hệ thống</div>
        <div class="tag"><span class="tag-dot ok"></span>Live</div>
    </div>

    <div class="metrics-grid">
        <div class="metric">
            <div class="metric-label">Server</div>
            <div class="metric-value" style="color:#22c55e">Online</div>
        </div>
        <div class="metric">
            <div class="metric-label">Database</div>
            <div class="metric-value" style="color:#38bdf8">Connected</div>
        </div>
        <div class="metric">
            <div class="metric-label">Port</div>
            <div class="metric-value" style="color:#fde68a">5000</div>
        </div>
    </div>

    <!-- TOTAL SLOT -->
    <div class="total-slot">
        <div class="total-slot-label">Tổng số chỗ còn trống</div>
        <div class="total-slot-value" id="totalSlot">--</div>
    </div>

    <!-- TOTAL IN / OUT -->
    <div class="summary-grid">
        <div class="summary-box">
            <div class="summary-label">Tổng xe vào</div>
            <div class="summary-value in" id="totalIn">0</div>
        </div>

        <div class="summary-box">
            <div class="summary-label">Tổng xe ra</div>
            <div class="summary-value out" id="totalOut">0</div>
        </div>
    </div>
    <div class="logout">
        <a href="/admin/logout">Đăng xuất</a>
    </div>
</section>

<!-- ===== RIGHT / SIDEBAR ===== -->
<aside class="card">
    <div class="card-header">
        <div class="card-title">Parking Activity Log</div>
        <div class="tag"><span class="tag-dot info"></span>Realtime</div>
    </div>

    <div class="log-container">
        <ul class="timeline" id="logList">
            <li class="timeline-item">Loading...</li>
        </ul>
    </div>

    <div class="timeline-caption">Tự động cập nhật mỗi 1 giây</div>
</aside>

</main>
</div>

<script>
async function loadLogs() {
    const res = await fetch('/api/logs');
    const logs = await res.json();

    const list = document.getElementById('logList');
    const totalSlot = document.getElementById('totalSlot');
    const totalIn = document.getElementById('totalIn');
    const totalOut = document.getElementById('totalOut');

    list.innerHTML = '';

    if (logs.length === 0) {
        list.innerHTML = '<li class="timeline-item">Chưa có dữ liệu</li>';
        totalSlot.textContent = '--';
        totalIn.textContent = 0;
        totalOut.textContent = 0;
        return;
    }

    // Slot hiện tại = log mới nhất
    totalSlot.textContent = logs[0].total_available;

    // Đếm IN / OUT
    let countIn = 0;
    let countOut = 0;

    logs.forEach(log => {
        if (log.action_type === 'IN') countIn++;
        if (log.action_type === 'OUT') countOut++;

        const color = log.action_type === 'IN' ? '#22c55e' : '#ef4444';
        const text  = log.action_type === 'IN' ? 'Xe vào bãi' : 'Xe rời bãi';

        const li = document.createElement('li');
        li.className = 'timeline-item';
        li.innerHTML = `
            <div style="color:${color}">
                ${text} · Còn ${log.total_available} chỗ
            </div>
            <div class="timeline-caption">${log.created_at}</div>
        `;
        list.appendChild(li);
    });

    totalIn.textContent = countIn;
    totalOut.textContent = countOut;
}

loadLogs();
setInterval(loadLogs, 1000);
</script>